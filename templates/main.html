{[ extends "base.html" ]}

{[ section "content" ]}
<script type="text/javascript" language="JavaScript">//<![CDATA[
	function onFilter (data)
	{
		if ("ok" == data.result)
			showTasksPage();
		else
			alert("Ошибочка вышла.");
	}
	function onTaskCreate (data)
	{
		if ("ok" == data.result)
		{
			showTasksPage();
			showLogsPage();
			alert("Задача успешно создана.");
			$("#createTask").clearForm();
			$("#accordion").accordion("activate", 1);
		}
		else
		{
			alert("Ошибка при создании задачи.");
		}
	}
	function deleteTask (id)
	{
		if (!confirm("Подтверждаете УДАЛЕНИЕ задачи?"))
			return false;
		$.post("/ajax/task/delete.json", {id: id, "delete": "Delete"}, function (data) {
			if ("ok" == data.result)
				showTasksPage();
			else
				alert("Ошибочка вышла.");
		}, "json");
	}
//]]></script>
<div id="accordion">
	<h1><a href="#">Новая задача</a></h1>
	<div>
		{% if createTaskForm:isSubmitted() and not createTaskForm:isValid() then %}
			{{ include("_msgs-and-errors.html", {form=createTaskForm}) }}
		{% end %}
		{{ safe(createTaskForm) }}
	</div>
	<h1><a href="#">Список задач</a></h1>
	<div>
		{{ safe(filterForm) }}
		<div id="tasks"></div>
		<script type="text/javascript" language="JavaScript">//<![CDATA[
			function showTasksPage (page)
			{
				page = page || $.cookie("tasksPage") || 1;
				$.cookie("tasksPage", page, 60);
				$.post("/ajax/task/list", {find: "Find", page: page}, function (data)	{ $("#tasks").html(data); }, "html");
			}
			$("textarea.resizable").resizable();
			showTasksPage($.cookie("tasksPage") || 1);
		//]]></script>
	</div>
	<h1><a href="#">История изменений</a></h1>
	<div>
		<div id="logs"></div>
		<script type="text/javascript" language="JavaScript">//<![CDATA[
			function showLogsPage (page)
			{
				page = page || $.cookie("logsPage") || 1;
				$.cookie("logsPage", page, 60);
				$.post("/ajax/log/list", {find: "Find", page: page}, function (data)	{ $("#logs").html(data); }, "html");
			}
			showLogsPage();
		//]]></script>
	</div>
</div>
<script type="text/javascript" language="JavaScript">//<![CDATA[
	$("#accordion").accordion({active: 1, autoHeight: false});
//]]></script>
{[ endSection() ]}
